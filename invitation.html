document.addEventListener("DOMContentLoaded", function() {
    const backgroundMusic = document.getElementById("background-music");
    const playMusicButton = document.getElementById("play-music");
    const stopMusicButton = document.getElementById("stop-music");
    const mainPhoto = document.getElementById("main-photo");
    const invitationSection = document.getElementById("invitation-section");

    // 从 sessionStorage 加载已保存的音乐 URL 和播放状态
    function loadMusicSettings() {
        const storedMusicUrl = sessionStorage.getItem('musicUrl');
        const musicPlaying = sessionStorage.getItem('musicPlaying') === 'true';

        if (storedMusicUrl) {
            backgroundMusic.src = storedMusicUrl;
            if (musicPlaying) {
                playMusicButton.style.display = "none";
                stopMusicButton.style.display = "inline";
                backgroundMusic.play().catch(error => {
                    console.error("播放音乐失败:", error);
                });
            } else {
                playMusicButton.style.display = "inline";
                stopMusicButton.style.display = "none";
            }
        } else {
            playBackgroundMusic(); // 默认开始播放音乐
        }
    }

    // 播放背景音乐
    function playBackgroundMusic() {
        backgroundMusic.play().catch(error => {
            console.error("播放背景音乐失败:", error);
        });
        playMusicButton.style.display = "none";
        stopMusicButton.style.display = "inline";
        sessionStorage.setItem('musicPlaying', 'true');
    }

    // 停止背景音乐
    function stopBackgroundMusic() {
        backgroundMusic.pause();
        stopMusicButton.style.display = "none";
        playMusicButton.style.display = "inline";
        sessionStorage.setItem('musicPlaying', 'false');
    }

    // 绑定按钮事件
    playMusicButton.addEventListener("click", playBackgroundMusic);
    stopMusicButton.addEventListener("click", stopBackgroundMusic);

    // 页面加载时加载保存的音乐设置
    loadMusicSettings();
});
