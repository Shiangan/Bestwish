document.addEventListener("DOMContentLoaded", function() {
    const form = document.getElementById("info-form");
    const playMusicButton = document.getElementById("play-music");
    const stopMusicButton = document.getElementById("stop-music");
    const backgroundMusic = document.getElementById("background-music");

    // Handle form submission
    form.addEventListener("submit", function(event) {
        event.preventDefault();

        const formData = new FormData(form);
        const additionalPhotos = Array.from(formData.getAll('additional-photos[]')).map(file => URL.createObjectURL(file));

        // Store form data in localStorage
        localStorage.setItem('name', formData.get('name'));
        localStorage.setItem('mainPhoto', URL.createObjectURL(formData.get('photo')));
        localStorage.setItem('additionalPhotos', JSON.stringify(additionalPhotos));
        localStorage.setItem('lifeStory', formData.get('life-story'));
        localStorage.setItem('paperObituary', URL.createObjectURL(formData.get('paper-obituary')));

        // Redirect to the next page
        window.location.href = "invitation.html";
    });

    // Load and display stored data on the invitation page
    const mainPhoto = document.getElementById('main-photo');
    const lifeStory = document.getElementById('life-story');
    const photoCarousel = document.querySelector('.carousel');
    const paperObituary = document.getElementById('paper-obituary');

    if (mainPhoto) mainPhoto.src = localStorage.getItem('mainPhoto');
    if (lifeStory) lifeStory.textContent = localStorage.getItem('lifeStory');
    if (paperObituary) paperObituary.src = localStorage.getItem('paperObituary');

    const additionalPhotos = JSON.parse(localStorage.getItem('additionalPhotos')) || [];
    additionalPhotos.forEach(url => {
        const imgDiv = document.createElement('div');
        const img = document.createElement('img');
        img.src = url;
        img.alt = 'Additional Photo';
        imgDiv.appendChild(img);
        photoCarousel.appendChild(imgDiv);
    });

    // Initialize Slick carousel
    $('.carousel').slick({
        dots: true,
        infinite: true,
        speed: 500,
        slidesToShow: 1,
        slidesToScroll: 1
    });

    // Music control
    playMusicButton.addEventListener('click', function() {
        backgroundMusic.play();
        playMusicButton.style.display = 'none';
        stopMusicButton.style.display = 'inline';
    });

    stopMusicButton.addEventListener('click', function() {
        backgroundMusic.pause();
        playMusicButton.style.display = 'inline';
        stopMusicButton.style.display = 'none';
    });
});
